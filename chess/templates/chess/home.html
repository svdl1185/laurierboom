<!-- templates/chess/home.html -->
{% extends 'chess/base.html' %}

{% block title %}De Laurierboom Chess Rankings{% endblock %}

{% block content %}
<!-- About section -->
<div class="card mb-4 shadow">
    <div class="card-header bg-dark text-white">
        <h2 class="card-title mb-0">About De Laurierboom</h2>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-8">
                <p class="lead">
                    Welcome to De Laurierboom.
                </p>
                <p>
                    We are a casual chess community based at De Laurierboom café in Amsterdam. 
                    We host bi-monthly blitz tournaments every other Friday at 8:00 PM.
                </p>
                <p>
                    This website is used to manage our tournaments and in-house Glicko-2 rating system. 
                    Feel free to register an account and join us at the café to participate in our next tournament!
                </p>
            </div>
            <div class="col-md-4 text-center">
                <div class="mt-3">
                    <a href="{% url 'simple_register' %}" class="btn btn-primary btn-lg">Register</a>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-lg-8">
        <div class="card mb-4 shadow">
            <div class="card-header bg-primary text-white">
                <h2 class="card-title mb-0">Player Rankings</h2>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Player</th>
                                <th>In-house Rating</th>
                                <th>FIDE Rating</th>
                                <th>Lichess</th>
                                <th>Chess.com</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for player in players %}
                                <tr>
                                    <td>{{ forloop.counter }}</td>
                                    <td>
                                        <a href="{% url 'player_detail' player.id %}">
                                            {{ player.get_full_name|default:player.username }}
                                        </a>
                                    </td>
                                    <td>{{ player.elo|floatformat:0 }}</td>
                                    <td>{{ player.fide_rating|default:"-" }}</td>
                                    <td>
                                        {% if player.lichess_account %}
                                            <a href="https://lichess.org/@/{{ player.lichess_account }}" target="_blank">
                                                {{ player.lichess_account }}
                                            </a>
                                        {% else %}
                                            -
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if player.chesscom_account %}
                                            <a href="https://chess.com/member/{{ player.chesscom_account }}" target="_blank">
                                                {{ player.chesscom_account }}
                                            </a>
                                        {% else %}
                                            -
                                        {% endif %}
                                    </td>
                                </tr>
                            {% empty %}
                                <tr>
                                    <td colspan="6" class="text-center">No players yet!</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-lg-4">
        <div class="card mb-4 shadow">
            <div class="card-header bg-success text-white">
                <h3 class="card-title mb-0">Upcoming Tournaments</h3>
            </div>
            <div class="card-body">
                <ul class="list-group list-group-flush">
                    {% for tournament in upcoming_tournaments %}
                        <li class="list-group-item">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <a href="{% url 'tournament_detail' tournament.id %}" class="text-decoration-none">
                                        <h5 class="mb-1">{{ tournament.name }}</h5>
                                    </a>
                                    <small class="text-muted">
                                        {{ tournament.date }}
                                        {% if tournament.start_time %}
                                            at {{ tournament.start_time }}
                                        {% endif %}
                                    </small>
                                </div>
                                <span class="badge bg-primary rounded-pill">
                                    {{ tournament.tournament_type|title }}
                                </span>
                            </div>
                        </li>
                    {% empty %}
                        <li class="list-group-item text-center">No upcoming tournaments</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
        
        <div class="card shadow">
            <div class="card-header bg-info text-white">
                <h3 class="card-title mb-0">Recent Tournaments</h3>
            </div>
            <div class="card-body">
                <ul class="list-group list-group-flush">
                    {% for tournament in recent_tournaments %}
                        <li class="list-group-item">
                            <a href="{% url 'tournament_detail' tournament.id %}" class="text-decoration-none">
                                <h5 class="mb-1">{{ tournament.name }}</h5>
                            </a>
                            <small class="text-muted">{{ tournament.date }}</small>
                            
                            {% with winner=tournament.standings.all|dictsort:"-score"|first %}
                                {% if winner %}
                                    <div class="mt-1">
                                        <span class="badge bg-warning">Winner: 
                                            <a href="{% url 'player_detail' winner.player.id %}" class="text-dark">
                                                {{ winner.player.get_full_name|default:winner.player.username }}
                                            </a>
                                        </span>
                                    </div>
                                {% endif %}
                            {% endwith %}
                        </li>
                    {% empty %}
                        <li class="list-group-item text-center">No completed tournaments</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}